# Dockerの通信経路

同じネットワーク内のコンテナは以下の情報で通信できる。

- IPアドレス
- コンテナ名

> コンテナ名がDNSに登録されると思えばいい

## 同じネットワーク内でtelnetしてみる

clientからserverへ23番ポートに対して`telnet`してみる。

```console
root@client(10.10.0.2):/ # telnet server 23
Trying 10.10.0.3...
Connected to server.
Escape character is '^]'.
Ubuntu 22.04.2 LTS
server login: docker
Password: 
Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.90.1-microsoft-standard-WSL2 x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

This system has been minimized by removing packages and content that are
not required on a system that users do not log into.

To restore this content, you can run the 'unminimize' command.
Last login: Sat Jul  8 17:34:11 UTC 2023 from client_in_nw1.network_seg3nw on pts/1
$ 
```

server側にちゃんとログインできた。

> server側にログインした後、`exit`すると当然コンテナが死ぬ。  
> どうしたらコンテナを残してログアウトするとかは不明。  
> コンテナって元々そういうもんでもないけど、クラウドサービスはどうしているんだろうか？

## 別ネットワーク

### ダメな例

```yaml
# client
  client_in_nw2:
    container_name: client_in_nw2
    build:
      context: ./dockerfiles
      dockerfile: client.Dockerfile
    hostname: client
    networks:
      - seg4nw1
      - seg4nw2
    stdin_open: true # -i
    tty: true # -t
# server
  server_in_nw2:
    container_name: server_in_nw2
    build:
      context: ./dockerfiles
      dockerfile: server.Dockerfile
    hostname: server
    networks:
      - seg4nw2
    stdin_open: true # -i
    tty: true # -t
```

このcompose構成だと

```console
root@client(10.20.10.2):/ # ping server
ping: server: Temporary failure in name resolution
```

そもそも`ping`すら通らない

### 解決する例

```yaml
  client_in_nw2:
    container_name: client_in_nw2
    build:
      context: ./dockerfiles
      dockerfile: client.Dockerfile
    hostname: client
    networks:
      - seg4nw1
      - seg4nw2
    stdin_open: true # -i
    tty: true # -t
```

クライアント側を二つのネットワークに所属させる。

```console
root@client(10.20.10.2 10.20.20.3):/ # telnet server 23
Trying 10.20.20.2...
Connected to server.
Escape character is '^]'.
Ubuntu 22.04.2 LTS
server login: docker
Password: 
Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.90.1-microsoft-standard-WSL2 x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

This system has been minimized by removing packages and content that are
not required on a system that users do not log into.

To restore this content, you can run the 'unminimize' command.

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

$ 
```

ログインできた。
