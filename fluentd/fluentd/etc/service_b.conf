<filter service_b_**>
  @type parser
  format syslog
  key_name message
  reserve_data true
</filter>

<match service_b_**>
  @type copy

  <store>
    @type elasticsearch
    host elasticsearch
    port 9200
    logstash_format true
    logstash_prefix nginx-b-log
    logstash_dateformat %Y%m%d
    include_tag_key true
    type_name access_log
    tag_key @log_name
    flush_interval 1s
  </store>

  <store>
    @type stdout
  </store>

  <buffer>
    @type file
    flush_mode interval
    flush_interval 10s
    path /var/log/fluentd/elasticsearch
    chunk_limit_size 512m
    flush_at_shutdown true
  </buffer>
</match>

# 2025-01-09 04:07:10 2025/01/08 19:07:10 [error] 22#22: send() failed (111: Connection refused) while logging to syslog, server: 10.10.10.10:24224
# 2025-01-09 04:07:10 2025/01/08 19:07:10 [warn] 22#22: *1 send() to syslog failed while logging request, client: 10.10.10.3, server: service-b, request: "GET /service-b.html HTTP/1.1", host: "localhost"
