# 1対1のリレーション

1対N、N対Nに比べてかなり特殊なケースである。

## ユーザーとプロファイル

usersテーブル

|UserID|UserName|E-mail|
|:--:|:--:|:--:|
|1|foo|`foo@gmail.com`|
|2|bar|`bar@gmail.com`|

profilesテーブル

|UserID|CompanyID|役職|他|
|:--:|:--:|:--:|:--:|
|1|1|部長|etc|
|2|1|課長|etc|

みたいなのがよく使われる。

## １つのテーブルじゃダメ？

|UserID|UserName|E-mail|CompanyID|役職|他|
|:--:|:--:|:--:|:--:|:--:|:--:|
|1|foo|`foo@gmail.com`|1|部長|etc|
|2|bar|`bar@gmail.com`|1|課長|etc|

こんなテーブルでも特に大きな問題はなさそうである。  
もっと言うと、これも有力なリレーションとも言える。

## もう少しマシな例を

### 発送・受領テーブル

users/profilesのような関係として、発送テーブルと受領テーブルを考えてみる。

発送受領ID|発送製品コード|発送数量|発送担当者コード|発送日|受領製品コード|受領数量|受領担当者コード|受領日
:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
1|AX10021|450|201|2014/12/7|AX10021|450|408|2014/12/9
2|CR20043|450|201|2014/12/10|CR20043|450|412|2014/12/11
3|GS10439|800|204|2014/12/16|GS10439|800|412|2014/12/17

こんなテーブルがあっとして、これは有力なリレーションだろうか？

「発送」時点で、このレコードは出来上がる訳である。  
その時、受領側のレコードはどう表現したらいいだろうか？  

受領担当者は決まっているんだろうか？  
受領担当者が決まるのは受領したタイミングであるとすれば、このリレーションの設計では受領側すべてをNULL許容しなければならない。

もちろん、受領コードを別途払い出し、別テーブルにしてもいいが、管理が面倒だ。

> あと、PostgreSQLにおいてdatetime型ってNULL許容できない気がするので破綻している。。。？

結果、これは、1対1リレーションが有力な設計であると思われる。

### 法人・個人

users/profilesの情報において、usersをcompaniesだとして深堀してみる。
個人事業主と法人格を与えてみよう。  
法人格には、登記地と資本金を入力させたい。

|CompanyID|CompanyName|個人・法人区分|登記地|資本金|
|:--:|:--:|:--:|:--:|:--:|
|1|foo|個人||
|2|bar|法人|xx市1-1-1|30,000,000|

やはり、発送・受領テーブルと同じくNULL許容カラムが発生する。  

## メリット

観点|１つのテーブル|1:1関係
:--:|:--:|:--:|
相方が未確定な状態を取るケース|相方に相当するカラムをNULL許容する必要がある|レコードが存在しないことがNULLを表す
別のDBを使いたい|別のDBなので表現不可能|外部キーなどで制約を課せないが、表現可能
アクセス権でユーザーを分けたい|無理|可能

## 参考

- [一対多・多対多・一対一の関係](https://www.accessdbstudy.net/entry/20140823/p1)
